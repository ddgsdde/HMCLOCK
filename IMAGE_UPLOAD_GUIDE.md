# 电子墨水屏图片上传指南

## 概述

我们为电子墨水屏时钟固件添加了完整的图片上传功能，支持通过蓝牙将图片传输到设备并显示。

## 支持的图片上传方式

### 1. Web蓝牙图片上传工具 ✅ (推荐)

使用我们开发的 `image_upload.html` 工具：

#### 功能特性
- 🖼️ 支持拖拽上传或文件选择
- 🔄 自动图片格式转换（JPG/PNG/GIF → 单色位图）
- 📏 多种预设屏幕尺寸支持
- 🎨 实时预览处理效果
- 📶 上传进度显示
- 🔗 Web蓝牙无线传输

#### 使用步骤
1. 打开 `image_upload.html` 页面
2. 点击"连接设备"连接电子墨水屏
3. 拖拽图片到上传区域或点击选择文件
4. 选择目标屏幕尺寸：
   - 212×104 (2.13" 黑白屏)
   - 250×122 (2.13" 三色屏)
   - 296×128 (2.9" 三色屏)
   - 自定义尺寸
5. 点击"处理图片"进行格式转换
6. 点击"上传到设备"传输图片
7. 在设备上切换到图片模式查看

### 2. 蓝牙指令上传 ✅ (高级用户)

通过蓝牙指令直接上传图片数据：

#### 指令格式
```
0xF0 + 图片头信息    // 宽度(2字节) + 高度(2字节) + 数据长度(1字节)
0xF1 + 图片数据块    // 分块传输图片数据
0xF3                // 上传完成信号
```

#### 数据格式
- 图片格式：单色位图 (1位深度)
- 数据排列：按行扫描，每8个像素打包为1字节
- 颜色映射：0=白色，1=黑色

### 3. 固件内置图片 ✅ (开发者)

在固件中直接嵌入图片数据：

```c
// 示例：16x16像素的笑脸图标
const uint8_t smile_icon[] = {
    0x00, 0x00, 0x3C, 0x3C, 0x42, 0x42, 0x99, 0x99,
    0xA1, 0x85, 0xA1, 0x85, 0x42, 0x42, 0x3C, 0x3C,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 在代码中调用
draw_image(x, y, 16, 16, smile_icon, BLACK);
```

## 图片处理建议

### 最佳图片特征
- ✅ 高对比度黑白图片
- ✅ 简洁的线条和形状
- ✅ 避免复杂的渐变和细节
- ✅ 文字建议使用粗体字体

### 尺寸建议
| 屏幕型号 | 分辨率 | 建议用途 |
|---------|--------|----------|
| 2.13" B/W | 212×104 | 简单图标、文字 |
| 2.13" B/W/R | 250×122 | 小图片、Logo |
| 2.9" B/W/R | 296×128 | 复杂图片、界面 |

### 图片优化技巧
1. **对比度调整**：增加黑白对比度
2. **边缘锐化**：突出图片轮廓
3. **降噪处理**：去除细小噪点
4. **尺寸适配**：保持宽高比或裁剪关键部分

## 技术实现细节

### 蓝牙传输协议
```
图片头 (6字节):
[0xF0][宽度低字节][宽度高字节][高度低字节][高度高字节][数据长度]

数据块 (最大19字节):
[0xF1][数据字节1][数据字节2]...[数据字节N]

完成信号 (1字节):
[0xF3]
```

### 位图数据格式
```
像素排列: 从左到右，从上到下
字节打包: 8个像素 = 1字节
位序排列: MSB在左，LSB在右

示例 (8像素):
像素: ●○●●○○●○
二进制: 10110010
十六进制: 0xB2
```

### 内存限制
- 最大图片数据：2048字节
- 对应最大像素：16384像素 (约128×128)
- 建议尺寸：不超过200×100像素

## 故障排除

### 常见问题

#### 1. 连接失败
- 确保设备处于广播状态
- 检查浏览器蓝牙权限
- 尝试刷新页面重新连接

#### 2. 图片显示异常
- 检查图片尺寸是否正确
- 确认图片对比度足够
- 尝试重新处理图片

#### 3. 上传中断
- 检查蓝牙连接稳定性
- 减小图片尺寸重试
- 确保设备电量充足

#### 4. 图片不显示
- 确认已切换到图片模式
- 检查上传是否完成
- 尝试强制刷新屏幕

### 调试方法
1. 打开浏览器开发者工具查看控制台日志
2. 检查设备串口输出信息
3. 使用简单的测试图片验证功能
4. 逐步增加图片复杂度

## 示例图片

### 适合的图片类型
- ✅ 简单图标 (WiFi、蓝牙、电池等)
- ✅ 文字标语
- ✅ 简单Logo
- ✅ 二维码
- ✅ 简笔画

### 不适合的图片类型
- ❌ 照片 (细节过多)
- ❌ 复杂渐变
- ❌ 细小文字
- ❌ 彩色图片 (会丢失颜色信息)

## 扩展功能

### 未来计划
1. **多图片管理**：支持存储多张图片
2. **图片动画**：简单的帧动画效果
3. **图片编辑**：在线图片编辑工具
4. **模板库**：预制图片模板
5. **云端同步**：图片云端存储和同步

### 开发接口
```c
// 图片管理API
int load_image(int id, const uint8_t* data, int width, int height);
int display_image(int id, int x, int y);
int delete_image(int id);
int list_images(int* ids, int max_count);
```

## 总结

通过Web蓝牙图片上传工具，用户可以轻松地将自己喜欢的图片上传到电子墨水屏设备上显示。这大大扩展了设备的应用场景，从简单的时钟显示扩展到个性化的信息展示平台。

### 主要优势
- 🚀 操作简单，无需专业知识
- 🔄 实时预览，所见即所得
- 📱 无线传输，方便快捷
- 🎨 自动优化，效果良好
- 🔧 开源代码，可自定义扩展